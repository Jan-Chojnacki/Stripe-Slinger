docker-build-and-push:
  stage: build & push
  image: docker:25
  services:
    - name: docker:25-dind
      command: ["--tls=false"]
  variables:
    DOCKER_HOST: tcp://docker:2375
    DOCKER_TLS_CERTDIR: ""
  before_script: []
  script:
    - .gitlab/ci/scripts/docker-build-and-push.sh
  rules:
    - if: '$CI_COMMIT_BRANCH == "master"'
    - if: '$CI_COMMIT_TAG'

release:
  stage: release
  image: alpine:3.20
  needs:
    - docker-build-and-push
  script:
    - .gitlab/ci/scripts/gitlab-release-from-tag.sh
  rules:
    - if: '$CI_COMMIT_TAG'
