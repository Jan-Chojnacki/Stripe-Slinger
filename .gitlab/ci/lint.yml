ci-smoke:
  stage: lint
  script:
    - echo "CI changed."
  rules:
    - changes:
        - .gitlab-ci.yml
        - .gitlab/ci/**/*
    - when: never

fmt:
  extends: .rust-changes
  stage: checks
  script:
    - .gitlab/ci/scripts/fmt.sh

clippy:
  extends: .rust-changes
  stage: checks
  script:
    - .gitlab/ci/scripts/clippy.sh
  rules:
    - !reference [.rust-changes, rules]
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event" && $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "master"'
    - if: '$CI_COMMIT_BRANCH == "master"'
    - if: '$CI_COMMIT_BRANCH'
      allow_failure: true
    - when: never
