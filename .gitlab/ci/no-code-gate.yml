no-code-gate:
  stage: checks
  script:
    - .gitlab/ci/scripts/no-code-gate.sh
  rules:
    - if: '$CI_COMMIT_BRANCH == "master"'
      when: never
    - changes:
        - "**/*.rs"
        - "**/build.rs"
        - "**/Cargo.toml"
        - "**/Cargo.lock"
        - "rust-toolchain*"
        - ".cargo/**/*"
        - "Dockerfile"
        - "Dockerfile.*"
        - "*/Dockerfile"
        - "docker/**/*"
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: on_success
    - if: '$CI_COMMIT_BRANCH == "master"'
      when: never
    - when: always
