build-runtime-image:
  stage: bootstrap
  image: docker:25
  services:
    - name: docker:25-dind
      command: ["--tls=false"]
  before_script: []
  variables:
    DOCKER_HOST: tcp://docker:2375
    DOCKER_TLS_CERTDIR: ""
    RUNTIME_IMAGE_REPO: "$CI_REGISTRY_IMAGE/runtime"
    RUNTIME_BASE_IMAGE: "rust:${CI_RUST_VERSION}"
  artifacts:
    reports:
      dotenv: runtime.env 
    expire_in: 1 day
  script:
    - .gitlab/ci/scripts/build-runtime-image.sh
  rules:
    - !reference [.rules-runtime-image, rules]
